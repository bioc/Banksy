<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial transcriptomic clustering • Banksy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Spatial transcriptomic clustering">
<meta property="og:description" content="Banksy is an R packaged that incorporates spatial information to 
    cluster cells in a feature space (e.g. gene expression). Spatial information
    is incorporated by averaging the features of the k nearest neighbours to 
    generate new neighbour features for a given cell. This is concatenated to
    the cell's own features to generate a combined block matrix which is used
    for constructing a nearest neighbour network and Leiden clustering.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">Banksy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/banksy-object.html">Working with BanksyObjects</a>
    </li>
    <li>
      <a href="articles/grid-search.html">Finding optimal clustering parameters</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="banksy" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#banksy" class="anchor"></a>Banksy</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>Banksy is an R package that incorporates spatial information to cluster cells in a feature space (e.g. gene expression). Spatial information is incorporated by averaging the features of the k nearest neighbours to generate new ‘neighbour’ features for a given cell. This is concatenated to the cell’s own features to generate a combined feature matrix which is used for constructing a nearest neighbour network. Leiden clustering is used to obtain spatially-informed clusters.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/remotes/man/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"jleechung/Banksy"</span><span class="op">)</span></code></pre></div>
<p>Load the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Banksy</span><span class="op">)</span></code></pre></div>
</div>
<div id="quick-start" class="section level2">
<h2 class="hasAnchor">
<a href="#quick-start" class="anchor"></a>Quick Start</h2>
<div id="input-data" class="section level3">
<h3 class="hasAnchor">
<a href="#input-data" class="anchor"></a>Input data</h3>
<p>Inputs consist of an expression matrix and cell locations. Sample data provided with the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'/extdata/expression.rds'</span>, package <span class="op">=</span> <span class="st">'Banksy'</span><span class="op">)</span><span class="op">)</span>
<span class="va">locs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'/extdata/locations.rds'</span>, package <span class="op">=</span> <span class="st">'Banksy'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The gene expression matrix for cells should either be a <code>data.frame</code> or sparse matrix of class <code>dgCMatrix</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">expr</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;          cell_4 cell_5 cell_6 cell_7 cell_8</span>
<span class="co">#&gt; Slc1a2        4      2     13     26      6</span>
<span class="co">#&gt; Scn4b         3      6     17      0      1</span>
<span class="co">#&gt; Itpr1         3      0     15      2      3</span>
<span class="co">#&gt; Slc25a23      3      0      5      3      1</span>
<span class="co">#&gt; Slc1a3        1      1      0     31      2</span>
<span class="co">#&gt; Nfib          1      1      1      4      0</span></code></pre></div>
<p>The locations of each cell as a <code>data.frame</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">locs</span><span class="op">)</span>
<span class="co">#&gt;            sdimx     sdimy</span>
<span class="co">#&gt; cell_4  68.49701 13951.186</span>
<span class="co">#&gt; cell_5  73.80242 18085.385</span>
<span class="co">#&gt; cell_6 119.55364  3143.897</span>
<span class="co">#&gt; cell_7 105.25295  2191.132</span>
<span class="co">#&gt; cell_8  96.64224  4806.681</span>
<span class="co">#&gt; cell_9 110.59598 14124.008</span></code></pre></div>
</div>
<div id="spatial-clustering" class="section level3">
<h3 class="hasAnchor">
<a href="#spatial-clustering" class="anchor"></a>Spatial clustering</h3>
<p>First, create a <em>BanksyObject</em> with the expression matrix and cell locations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bank</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/BanksyObject-class.html">BanksyObject</a></span><span class="op">(</span>own.expr <span class="op">=</span> <span class="va">expr</span>,
                     cell.locs <span class="op">=</span> <span class="va">locs</span><span class="op">)</span></code></pre></div>
<p>Compute the neighbour matrix, and scale and normalize matrix. The options below are defaults and listed for clarity.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bank</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ComputeBanksy.html">ComputeBanksy</a></span><span class="op">(</span><span class="va">bank</span>,
                      normalizeColumns <span class="op">=</span> <span class="cn">TRUE</span>,
                      normalizeColumnsTo <span class="op">=</span> <span class="fl">100</span>,
                      zScaleRows <span class="op">=</span> <span class="cn">TRUE</span>,
                      zScaleBeforeAveraging <span class="op">=</span> <span class="cn">FALSE</span>,
                      zScaleOwnAfterAveraging <span class="op">=</span> <span class="cn">TRUE</span>,
                      zScaleNbrAfterAveraging <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Performing normalization...</span>
<span class="co">#&gt; Computing Banksy matrices...</span>
<span class="co">#&gt; Spatial mode is kNN_r, k_geom = 10</span>
<span class="co">#&gt; Banksy matrix: 71.479 sec elapsed</span></code></pre></div>
<p>Obtain clusters for selected parameters.</p>
<ul>
<li>
<code>lambda</code>. A mixing parameter from 0 to 1 which determines how much spatial information is incorporated.<br>
</li>
<li>
<code>resolution</code>. Leiden clustering resolution.<br>
</li>
<li>
<code>kneighbours</code>. Number of k neighbours to use for constructing sNN.</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bank</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ClusterBanksy.html">ClusterBanksy</a></span><span class="op">(</span><span class="va">bank</span>, lambda <span class="op">=</span> <span class="fl">0.25</span>,
                            resolution <span class="op">=</span> <span class="fl">1.2</span>,
                            kneighbours <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  external python path provided and will be used</span>
<span class="co">#&gt; Iteration 1 out of 1</span>
<span class="co">#&gt; Consider to install these (optional) packages to run all possible Giotto commands:  RTriangle FactoMiner</span>
<span class="co">#&gt;  Giotto does not automatically install all these packages as they are not absolutely required and this reduces the number of dependencieshvg  was not found in the gene metadata information, all genes will be used</span>
<span class="co">#&gt; Finished clustering for Lambda=0.25, Resolution=1.2, K Neighbours=30</span>
<span class="co">#&gt; 38.15 sec elapsed</span></code></pre></div>
</div>
<div id="visualization" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization" class="anchor"></a>Visualization</h3>
<p>UMAP visualization:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plotUMAP.html">plotUMAP</a></span><span class="op">(</span><span class="va">bank</span>, params <span class="op">=</span> <span class="st">'res1.2_lam0.25_k30'</span>, pt.size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
<p>Spatial plot:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plotSpatialDims.html">plotSpatialDims</a></span><span class="op">(</span><span class="va">bank</span>, params <span class="op">=</span> <span class="st">'res1.2_lam0.25_k30'</span>, pt.size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="100%"></p>
</div>
</div>
<div id="session-information" class="section level2">
<h2 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session information</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 3.6.0 (2019-04-26)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Ubuntu 18.04.2 LTS</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1</span>
<span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.7.1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] C</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] Banksy_0.99.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] reticulate_1.14    tidyselect_0.2.5   xfun_0.12          purrr_0.3.3       </span>
<span class="co">#&gt;  [5] lattice_0.20-38    Giotto_1.0.2       colorspace_1.4-1   htmltools_0.4.0   </span>
<span class="co">#&gt;  [9] yaml_2.2.0         rlang_0.4.4        pracma_2.3.3       pillar_1.4.1      </span>
<span class="co">#&gt; [13] glue_1.3.1         rappdirs_0.3.1     uwot_0.1.5         RColorBrewer_1.1-2</span>
<span class="co">#&gt; [17] lifecycle_0.1.0    plyr_1.8.5         stringr_1.4.0      tictoc_1.0.1      </span>
<span class="co">#&gt; [21] munsell_0.5.0      gtable_0.3.0       codetools_0.2-16   evaluate_0.14     </span>
<span class="co">#&gt; [25] labeling_0.3       knitr_1.27         irlba_2.3.3        parallel_3.6.0    </span>
<span class="co">#&gt; [29] Rcpp_1.0.5         scales_1.1.0       dbscan_1.1-5       RcppParallel_4.4.4</span>
<span class="co">#&gt; [33] jsonlite_1.6       farver_2.0.3       RSpectra_0.16-0    gridExtra_2.3     </span>
<span class="co">#&gt; [37] ggplot2_3.3.2      digest_0.6.19      stringi_1.4.5      dplyr_0.8.4       </span>
<span class="co">#&gt; [41] ggrepel_0.8.1      cowplot_1.0.0      grid_3.6.0         tools_3.6.0       </span>
<span class="co">#&gt; [45] magrittr_1.5       RcppAnnoy_0.0.14   tibble_2.1.3       crayon_1.3.4      </span>
<span class="co">#&gt; [49] pkgconfig_2.0.2    Matrix_1.2-17      data.table_1.12.8  assertthat_0.2.1  </span>
<span class="co">#&gt; [53] rmarkdown_2.1      R6_2.4.0           igraph_1.2.4.2     compiler_3.6.0</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Vipul Singhal <br><small class="roles"> Author </small>  </li>
<li>Joseph Lee <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Vipul Singhal, Joseph Lee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
